/* @flow */
export type EditorRender = (props: {
  value: mixed,
  handleChange: (newValue: mixed) => void,
}) => React.Element<any>;

export type CellChangeHandler = (rowData: Object) => Object;

export type EditorDisplay = 'dropdown' | 'dialog';

export type ColumnProps = {|
  +getter: (rowData: Object) => mixed,
  +render?: (value: mixed) => React$Node,
  +updater?: (value: mixed) => CellChangeHandler,
  +sortable?: boolean | ((value: mixed) => boolean),
  +editor?: EditorRender | 'inline',
  +editorDisplay?: EditorDisplay,
  +label?: string,
|};

export type CellProps = {|
  +value: mixed,
  +render: $PropertyType<ColumnProps, 'render'>,
  +updater: $PropertyType<ColumnProps, 'updater'>,
  +editor: $PropertyType<ColumnProps, 'editor'>,
  +editorDisplay: $PropertyType<ColumnProps, 'editorDisplay'>,
  +handleRowChange: (handler: CellChangeHandler) => void,
  +index: number,
  +storeValue: (index: number, value: mixed) => void,
|};

export type CellState = {|
  isEditing: boolean,
  isMenuOpen: boolean,
  previousValue: mixed,
|};

export type Column = React.ComponentType<ColumnProps>;

export type ColumnChildren = React.ChildrenArray<React.Element<Column>>;

export type RowChangeHandler = (id: string, newData: Object) => void;

export type RowProps = {|
  +id: string,
  +children: ColumnChildren,
  +onRowChange: RowChangeHandler,
  +data: Object,
  +storeData: (id: string, index: number, value: mixed) => void,
|};

export type RowRender = (props: { data: Object }) => React.Element<any>;

export type Row = React.ComponentType<RowProps>;

export type GridSortOrder = 'asc' | 'desc' | 'none';
export type GridProps = {
  ids: string[],
  onRowChange: RowChangeHandler,
  children: ColumnChildren,
  enhancer: (render: RowRender) => React.Element<any>,
  decorator: () => (Wrapped: Row) => React.Element<any>,
};
export type GridState = {|
  ids: string[],
  sortIndex: number,
  sortOrder: GridSortOrder,
|};

declare module 'ekko' {
  declare export class Column extends React$Component<ColumnProps> {}
  declare export var Row: React$ComponentType<RowProps>;
  declare export var Grid: React$ComponentType<GridProps>;
}
